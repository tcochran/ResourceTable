if(typeof ResourceTable==="undefined"){ResourceTable={};console.log("here!")}ResourceTable.FilterTemplate="filter[<%= key %>]";ResourceTable.StateMethods={hash:function(){return new ResourceTable.HashUrlState()},memory:function(){return new ResourceTable.MemoryState()}};ResourceTable.Loader=function(e,g,h,b,a,i,c,d,f){var j=this;this.state=f();this.renderDataCallBack=g;this.renderViewCallBack=h;this.beforeDataLoad=i||function(){};this.afterDataLoad=c||function(){};this.pagination=new ResourceTable.Pagination();this.filterTemplate=_.template(ResourceTable.FilterTemplate);this.defaultFilter=b||{};this.failureCallBack=d||function(){};this.defaultSort=a||{};this.state.onChange(function(){j.load()});j.datasource=ResourceTable.DataSource.JqueryAjax(new ResourceTable.Url(e))};ResourceTable.Loader.prototype.sort=function(a,b){this.state.change({sort:a,sort_direction:b})};ResourceTable.Loader.prototype.filter=function(c){var b={};var a=this;_.each(c,function(e,d){b[a.filterTemplate({key:d})]=e});this.state.change(b)};ResourceTable.Loader.prototype.currentState=function(){return this.state.currentState};ResourceTable.Loader.prototype.change_page=function(a){this.state.change({page:a})};ResourceTable.Loader.prototype.load=function(){var a=this;if(!this.state.hasFilter()&&!_.isEmpty(this.defaultFilter)){this.filter(this.defaultFilter);return}if(!this.state.hasSort()&&!_.isEmpty(this.defaultSort)){this.sort(this.defaultSort.key,this.defaultSort.direction);return}a.beforeDataLoad();console.log("here");a.datasource.load(this.state,function(b){var c=a.state.currentState;console.log(c);c.paginationSummary=a.pagination.generate(b);a.renderViewCallBack(a.state.currentState);a.renderDataCallBack(b,"",a.state.currentState);a.afterDataLoad()})};ResourceTable.Navigation={};ResourceTable.Navigation.change_hash=function(a){window.location.hash=a};ResourceTable.HashUrlState=function(){this.refresh()};ResourceTable.HashUrlState.prototype.refresh=function(){var a=window.location.href;this.query=this.parse_hash(a)};ResourceTable.HashUrlState.prototype.parse_hash=function(b){var c=b.match(/([&#])([^#&=]+)=?([^&#]+)/g)||[];var a={};_.each(c,function(e){var d=/^[&#](.+)=(.+)$/.exec(e);if(d!=null){a[d[1]]=d[2]}});this.filterSize=_.filter(c,function(d){return d.indexOf!==-1}).length;this.currentState=this.parseUrlDotNetStyle(a);return a};ResourceTable.HashUrlState.prototype.parseUrlDotNetStyle=function(a){var c={};_.each(a,function(f,e){var d=e.match(/^filter\[(\w+)\]$/);if(d!=null){c[d[1]]=f}});var b={page:a.page,sort:{key:a.sort,direction:a.sort_direction},filter:c};return b};ResourceTable.HashUrlState.prototype.change=function(a){var b=this;_.each(a,function(d,c){b.query[c]=d});ResourceTable.Navigation.change_hash(ResourceTable.Url.hash_to_query(this))};ResourceTable.HashUrlState.prototype.hasFilter=function(){return this.filterSize>0};ResourceTable.HashUrlState.prototype.hasSort=function(){return !_.isEmpty(this.query.sort)};ResourceTable.HashUrlState.prototype.onChange=function(b){var a=this;if("onhashchange" in window){window.onhashchange=function(){a.refresh();b()}}else{var c=window.location.hash;window.setInterval(function(){if(window.location.hash!=c){c=window.location.hash;a.refresh();b()}},100)}};ResourceTable.MemoryState=function(){this.query={};this.currentState={sort:{},filter:{}}};ResourceTable.MemoryState.prototype.hasFilter=function(){return !_.isEmpty(this.query)};ResourceTable.MemoryState.prototype.hasSort=function(){return !_.isEmpty(this.query.sort)};ResourceTable.MemoryState.prototype.onChange=function(a){this.onChangeCallback=a};ResourceTable.MemoryState.prototype.change=function(a){this.query=_.extend(this.query,a);this.onChangeCallback()};ResourceTable.MemoryState.prototype.refresh=function(){};ResourceTable.Pagination=function(){this.numOfLinks=1};ResourceTable.Pagination.prototype._calculatefirstAndLastPage=function(b){var a=Math.ceil(b.total/b.page_size);var d=b.page-this.numOfLinks;var c=b.page+this.numOfLinks;if(c>a){c=a;d=c-(2*this.numOfLinks)}if(d<1){c=1+(this.numOfLinks*2);if(c>a){c=a}d=1}return[d,c]};ResourceTable.Pagination.prototype.generate=function(f){var b={name:"Previous",link:f.page-1,disabled:f.page==1};var d=[b];var e=this._calculatefirstAndLastPage(f);if(e[0]>1){d.push({name:"1",link:1,disabled:false});if(e[0]>2){d.push({name:"...",link:"",disabled:true})}}_.chain(_.range(e[0],(e[1]+1))).each(function(h){d.push({name:h.toString(),link:h,disabled:h==f.page})});var g=e[1]==f.page;var c=Math.ceil(f.total/f.page_size);if(f.page!=c&&(e[1]<c)){if((e[1]+1)<c){d.push({name:"...",link:"",disabled:true})}d.push({name:c.toString(),link:c,disabled:false})}var a={name:"Next",link:f.page+1,disabled:g};d.push(a);return d};(function(a){a.widget("ui.resourceTable",{options:{url:"",renderDataCallBack:function(b){},paginationElement:a({}),sortElements:a({}),filterChanged:function(b){},failureBackBack:function(b){},stateMethod:"memory",defaultSort:{}},_create:function(){var b=this;this.filters=new ResourceTableView.Filters(b.options.filterElements,b);this.table=new ResourceTable.Loader(this.options.url,this.options.renderDataCallBack,function(c){b._renderView(c)},this.filters.currentState(),this.options.defaultSort,this.options.beforeDataLoad,this.options.afterDataLoad,this.options.failureCallBack,ResourceTable.StateMethods[this.options.stateMethod]);b._renderFilters(this.table.currentState().filter);b.options.sortElements.click(function(){b._toggleSort(a(this));return false})},sort:function(b,c){this.table.sort(b,c)},filter:function(b){this.table.filter(b);this.options.filterChanged(b)},load:function(){this.table.load()},_toggleSort:function(b){var c=b.hasClass("sort-ascending")?"descending":"ascending";this.sort(b.attr("name")||b.data("name"),c)},_renderView:function(c){var b=this;b._renderPagination(c.paginationSummary);b._renderSort(c.sort);b._renderFilters(c.filter)},_renderPagination:function(d){var c=this;var b=this.options.paginationElement;b.empty();_.each(d,function(e){if(!e.disabled){var f=a("<a>",{href:""}).html(e.name);b.append(f);f.click(function(){c.table.change_page(e.link);return false})}else{b.append(a("<span>").html(e.name))}})},_renderSort:function(c){if(c.key==undefined){return}this.options.sortElements.removeClass("sort-ascending sort-descending");var b=_.find(this.options.sortElements,function(d){return a(d).is("[name='"+c.key+"']")||a(d).data("name")==c.key});a(b).addClass("sort-"+c.direction)},_renderFilters:function(b){this.filters.setFilterValues(b)}})}(jQuery));ResourceTableView={};ResourceTableView.Filters=function(){};ResourceTableView.Filters=function(b,c){var a=this;a.element=b;a.filters={};_.each(b,function(e){var e=$(e);var d=e.attr("name");if(e.is("select")){a.filters[d]=new ResourceTableView.SelectFilter(d,e,c)}else{if(e.is(".date-picker")){a.filters[d]=new ResourceTableView.DatePickerFilter(d,e,c)}else{if(e.is("input[type='radio']")){a.filters[d]=new ResourceTableView.RadioButtonFilter(d,e,c)}}}})};ResourceTableView.Filters.prototype.setFilterValues=function(b){var a=this;_.each(b,function(d,c){if(a.filters[c]){a.filters[c].setValue(d)}})};ResourceTableView.Filters.prototype.currentState=function(){var a=this;var b={};_.each(a.filters,function(d,c){b[c]=d.getValue()});return b};ResourceTableView.SelectFilter=function(b,a,c){this.element=a;this.resourceTable=c;a.change(function(){var d={};d[b]=a.val();c.filter(d)})};ResourceTableView.SelectFilter.prototype.setValue=function(a){this.element.val(a)};ResourceTableView.SelectFilter.prototype.getValue=function(){return this.element.val()};ResourceTableView.DatePickerFilter=function(b,a,d){this.element=a;this.resourceTable=d;var c=function(){var e={};e[b]=a.val();d.filter(e)};a.change(c).blur(c)};ResourceTableView.DatePickerFilter.prototype.setValue=function(a){this.element.datepicker("setDate",a);this.element.attr("value",a)};ResourceTableView.DatePickerFilter.prototype.getValue=function(){return this.element.val()};ResourceTableView.RadioButtonFilter=function(b,a,c){this.element=a;this.resourceTable=c;a.change(function(){var d={};var e=$.grep(a,function(f){return $(f).is(":checked")});d[b]=$(e).val();c.filter(d)})};ResourceTableView.RadioButtonFilter.prototype.setValue=function(b){var a=$.grep(this.element,function(c){return $(c).val()==b});$(a).attr("checked",true)};ResourceTableView.RadioButtonFilter.prototype.getValue=function(){var a=$.grep(this.element,function(b){return $(b).is(":checked")});return $(a).val()};