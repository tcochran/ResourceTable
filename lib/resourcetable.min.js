if(typeof ResourceTable==="undefined"){ResourceTable={}}ResourceTable.FilterTemplate="filter[<%= key %>]";ResourceTable.StateMethods={hash:function(){return new ResourceTable.HashUrlState()},memory:function(){return new ResourceTable.MemoryState()}};ResourceTable.Loader=function(b){var a=this;var c={beforeDataLoad:function(){},onDataLoad:function(){},afterDataLoad:function(){},onError:function(){},defaultFilter:{},defaultSort:{}};a.options=_.extend(c,b);a.state=a.options.stateMethod();a.pagination=new ResourceTable.Pagination();a.datasource=ResourceTable.DataSource.JqueryAjax(a.options.baseUrl);a.state.onChange(function(){a.load()})};ResourceTable.Loader.prototype.sort=function(a,b){this.state.change({sort:{key:a,direction:b}})};ResourceTable.Loader.prototype.filter=function(d){var c={};var a=this;var b=_.clone(a.state.currentState.filter);_.extend(b,d);a.state.change({filter:b})};ResourceTable.Loader.prototype.currentState=function(){return this.state.currentState};ResourceTable.Loader.prototype.changePage=function(a){this.state.change({page:a})};ResourceTable.Loader.prototype.load=function(){var a=this;if(!a.state.hasFilter()&&!_.isEmpty(a.defaultFilter)){a.filter(a.options.defaultFilter);return}if(!this.state.hasSort()&&!_.isEmpty(this.defaultSort)){a.sort(a.options.defaultSort.key,a.options.defaultSort.direction);return}a.options.beforeDataLoad(a.state.currentState);a.datasource.load(this.state,function(b,c){c.paginationSummary=a.pagination.generate(b);a.options.onLoad(b,c);a.options.afterDataLoad(c)})};if(typeof ResourceTable==="undefined"){ResourceTable={}}ResourceTable.Pagination=function(){this.numOfLinks=2};ResourceTable.Pagination.prototype._calculatefirstAndLastPage=function(b){var a=Math.ceil(b.total/b.page_size);var d=b.page-this.numOfLinks;var c=b.page+this.numOfLinks;if(c>a){c=a;d=c-(2*this.numOfLinks)}if(d<1){c=1+(this.numOfLinks*2);if(c>a){c=a}d=1}return[d,c]};ResourceTable.Pagination.prototype.generate=function(f){var b={name:"Previous",link:f.page-1,disabled:f.page==1};var d=[b];var e=this._calculatefirstAndLastPage(f);if(e[0]>1){d.push({name:"1",link:1,disabled:false});if(e[0]>2){d.push({name:"...",link:"",disabled:true})}}_.chain(_.range(e[0],(e[1]+1))).each(function(h){d.push({name:h.toString(),link:h,disabled:h==f.page})});var g=e[1]==f.page;var c=Math.ceil(f.total/f.page_size);if(f.page!=c&&(e[1]<c)){if((e[1]+1)<c){d.push({name:"...",link:"",disabled:true})}d.push({name:c.toString(),link:c,disabled:false})}var a={name:"Next",link:f.page+1,disabled:g};d.push(a);return d};if(typeof ResourceTable==="undefined"){ResourceTable={}}ResourceTable.Navigation={};ResourceTable.Navigation.change_hash=function(a){window.location.hash=a};ResourceTable.HashUrlState=function(){this.refresh()};ResourceTable.HashUrlState.prototype.refresh=function(){var a=window.location.href;this.currentState=this.parse_hash(a)};ResourceTable.HashUrlState.prototype.parse_hash=function(b){var c=b.match(/([&#])([^#&=]+)=?([^&#]+)/g)||[];var a={};_.each(c,function(e){var d=/^[&#](.+)=(.+)$/.exec(e);if(d!=null){a[d[1]]=d[2]}});this.filterSize=_.filter(c,function(d){return d.indexOf!==-1}).length;return this.parseUrlDotNetStyle(a)};ResourceTable.HashUrlState.prototype.parseUrlDotNetStyle=function(a){var c={};_.each(a,function(f,e){var d=e.match(/^filter\[(\w+)\]$/);if(d!=null){c[d[1]]=f}});var b={page:a.page,sort:{key:a.sort,direction:a.sort_direction},filter:c};return b};ResourceTable.HashUrlState.prototype.change=function(a){var b=this;_.extend(this.currentState,a);ResourceTable.Navigation.change_hash(ResourceTable.Url.hash_to_query(this.currentState))};ResourceTable.HashUrlState.prototype.hasFilter=function(){return !_.isEmpty(this.currentState.filter)};ResourceTable.HashUrlState.prototype.hasSort=function(){return !_.isEmpty(this.currentState.sort)};ResourceTable.HashUrlState.prototype.onChange=function(b){var a=this;if("onhashchange" in window){window.onhashchange=function(){a.refresh();b()}}else{var c=window.location.hash;window.setInterval(function(){if(window.location.hash!=c){c=window.location.hash;a.refresh();b()}},100)}};ResourceTable.MemoryState=function(){this.currentState={sort:{},filter:{}}};ResourceTable.MemoryState.prototype.hasFilter=function(){return !_.isEmpty(this.currentState.filter)};ResourceTable.MemoryState.prototype.hasSort=function(){return !_.isEmpty(this.currentState.sort)};ResourceTable.MemoryState.prototype.onChange=function(a){this.onChangeCallback=a};ResourceTable.MemoryState.prototype.change=function(a){this.query=_.extend(this.currentState,a);this.onChangeCallback()};ResourceTable.MemoryState.prototype.refresh=function(){};if(typeof ResourceTable==="undefined"){ResourceTable={}}ResourceTable.Url={};ResourceTable.Url.hash_to_query=function(b){var a={};_.each(b.filter,function(d,c){a[_.template(ResourceTable.FilterTemplate)({key:c})]=d});if(b.page!==undefined){a.page=b.page}if(b.sort!==undefined&&b.sort.key!==undefined){a.sort=b.sort.key;a.sort_direction=b.sort.direction}return _.map(a,function(d,c){return c+"="+d}).join("&")};ResourceTable.Url.hash_to_url=function(d,c){var a=/\?/.test(d)?"&":"?";var b=d+a;b+=ResourceTable.Url.hash_to_query(c.currentState);return b};ResourceTable.DataSource={};ResourceTable.DataSource.JqueryAjax=function(b){var a=function(e,f,c){var d=ResourceTable.Url.hash_to_url(b,e);$.ajax({url:d,cache:false,async:true,dataType:"json",success:function(g){e.currentState.url=d;e.currentState.page=g.page;f(g,e.currentState)},error:function(g,i,h){c(i+" - "+h)}})};return{load:a}};ResourceTable.DataSource.Json=function(b){var a=function(d,e,c){e(b)};return{load:a}};(function(a){a.widget("ui.resourceTable",{options:{url:"",renderDataCallBack:function(c,b){},paginationElement:a({}),sortElements:a({}),filterChanged:function(b){},failureBackBack:function(b){},stateMethod:"memory",defaultSort:{}},_create:function(){var b=this;this.filters=new ResourceTableView.Filters(b.options.filterElements,b);var c={baseUrl:b.options.url,beforeLoad:b.options.beforeDataLoad,onLoad:function(e,d){b._renderView(d);b.options.renderDataCallBack(e,d)},afterLoad:b.options.afterDataLoad,defaultSort:b.options.defaultSort,defaultFilter:b.filters.currentState(),stateMethod:ResourceTable.StateMethods[b.options.stateMethod]};b.table=new ResourceTable.Loader(c);b._renderFilters(this.table.currentState().filter);b.options.sortElements.click(function(){b._toggleSort(a(this));return false})},sort:function(b,c){this.table.sort(b,c)},filter:function(b){this.table.filter(b);this.options.filterChanged(b)},load:function(){this.table.load()},_toggleSort:function(b){var c=b.hasClass("sort-ascending")?"descending":"ascending";this.sort(b.attr("name")||b.data("name"),c)},_renderView:function(c){var b=this;b._renderPagination(c.paginationSummary);b._renderSort(c.sort);b._renderFilters(c.filter)},_renderPagination:function(d){var c=this;var b=this.options.paginationElement;b.empty();_.each(d,function(e){if(!e.disabled){var f=a("<a>",{href:""}).html(e.name);b.append(f);f.click(function(){c.table.change_page(e.link);return false})}else{b.append(a("<span>").html(e.name))}})},_renderSort:function(c){if(c.key==undefined){return}this.options.sortElements.removeClass("sort-ascending sort-descending");var b=_.find(this.options.sortElements,function(d){return a(d).is("[name='"+c.key+"']")||a(d).data("name")==c.key});a(b).addClass("sort-"+c.direction)},_renderFilters:function(b){this.filters.setFilterValues(b)}})}(jQuery));ResourceTableView={};ResourceTableView.Filters=function(){};ResourceTableView.Filters=function(b,c){var a=this;a.element=b;a.filters={};_.each(b,function(e){var e=$(e);var d=e.attr("name");if(e.is("select")){a.filters[d]=new ResourceTableView.SelectFilter(d,e,c)}else{if(e.is(".date-picker")){a.filters[d]=new ResourceTableView.DatePickerFilter(d,e,c)}else{if(e.is("input[type='radio']")){a.filters[d]=new ResourceTableView.RadioButtonFilter(d,e,c)}}}})};ResourceTableView.Filters.prototype.setFilterValues=function(b){var a=this;_.each(b,function(d,c){if(a.filters[c]){a.filters[c].setValue(d)}})};ResourceTableView.Filters.prototype.currentState=function(){var a=this;var b={};_.each(a.filters,function(d,c){b[c]=d.getValue()});return b};ResourceTableView.SelectFilter=function(b,a,c){this.element=a;this.resourceTable=c;a.change(function(){var d={};d[b]=a.val();c.filter(d)})};ResourceTableView.SelectFilter.prototype.setValue=function(a){this.element.val(a)};ResourceTableView.SelectFilter.prototype.getValue=function(){return this.element.val()};ResourceTableView.DatePickerFilter=function(b,a,d){this.element=a;this.resourceTable=d;var c=function(){var e={};e[b]=a.val();d.filter(e)};a.change(c).blur(c)};ResourceTableView.DatePickerFilter.prototype.setValue=function(a){this.element.datepicker("setDate",a);this.element.attr("value",a)};ResourceTableView.DatePickerFilter.prototype.getValue=function(){return this.element.val()};ResourceTableView.RadioButtonFilter=function(b,a,c){this.element=a;this.resourceTable=c;a.change(function(){var d={};var e=$.grep(a,function(f){return $(f).is(":checked")});d[b]=$(e).val();c.filter(d)})};ResourceTableView.RadioButtonFilter.prototype.setValue=function(b){var a=$.grep(this.element,function(c){return $(c).val()==b});$(a).attr("checked",true)};ResourceTableView.RadioButtonFilter.prototype.getValue=function(){var a=$.grep(this.element,function(b){return $(b).is(":checked")});return $(a).val()};